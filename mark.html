<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Pasugame - Dino Game</title>
<style>
  /* ... style เหมือนเดิมครับ ไม่เปลี่ยนแปลง */
  html, body {
    margin:0; padding:0; overflow:hidden;
    font-family: Arial, sans-serif;
    background:#000;
  }
  #game {
    position: relative;
    width: 100vw;
    height: 100vh;
    background: url("Background.webp") no-repeat center center/cover;
  }
  #ground {
    position: absolute;
    bottom: 0;
    width: 100%;
    height: 10vh;
    background: url("ground.jpg") repeat-x center;
    z-index: 1;
  }
  #dino {
    position: absolute;
    bottom: 10vh;
    left: 8vw;
    width: 14vw;
    aspect-ratio: 391 / 322;
    background: url("myDino.png") no-repeat center bottom / contain;
    z-index: 10;
    transition: bottom 0.2s ease, height 0.3s ease;
  }
  #dino.slide {
    height: calc(14vw * 0.5) !important;
  }
  #score, #coins {
    position: fixed;
    top: 10px;
    font-size: 20px;
    font-weight: bold;
    color: #fff;
    z-index: 20;
    user-select:none;
  }
  #score { right: 20px; }
  #coins { right: 150px; }
  #lobby {
    position: absolute;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.6);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    z-index: 100;
  }
  #logo {
    margin-bottom: 40px;
    width: 300px;
    height: auto;
  }
  #playBtn {
    width: 180px; height: 80px;
    background: url("play.png") center/contain no-repeat;
    border: none; cursor: pointer;
    margin-bottom: 20px;
  }
  #lobbyButtons {
    position: absolute; top: 10px; right: 10px;
    display: flex; gap: 10px;
  }
  .topBtn {
    width: 80px; height: 80px;
    background-size: contain;
    background-position: center;
    background-repeat: no-repeat;
    border: none;
    border-radius: 10px;
    cursor: pointer;
  }
  .modal-bg {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.7);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 200;
    flex-direction: column;
  }
  .modal-panel {
    background: white;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 0 10px #000;
    max-width: 400px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
  }
  .charItem {
    display: flex; align-items: center;
    justify-content: space-between;
    margin-bottom: 10px;
  }
  .charItem img {
    width: 80px; height: auto;
    border-radius: 5px;
  }
  .charItem button {
    padding: 7px 14px;
    font-size: 14px;
    cursor: pointer;
    border: none;
    background-color: #2196F3;
    color: white;
    border-radius: 5px;
  }
  .closeBtn {
    position: absolute;
    top: 5px; right: 10px;
    font-size: 18px; color: red;
    cursor: pointer;
    user-select: none;
  }
  #gameOver {
    position: absolute;
    width: 100%; height: 100%;
    top: 0; left: 0;
    background: rgba(0, 0, 0, 0.7);
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 28px;
    z-index: 300;
  }
  #gameOver button {
    margin: 10px;
    padding: 12px 40px;
    font-size: 18px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
  }
  #jumpBtn, #slideBtn {
    position: fixed;
    bottom: 20px;
    width: 90px; height: 90px;
    background-size: contain;
    background-position: center;
    background-repeat: no-repeat;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    z-index: 400;
  }
  #jumpBtn { right: 110px; background-image: url("jump.png"); }
  #slideBtn { right: 20px; background-image: url("slide.png"); }
  .obstacle {
    position: absolute;
    bottom: 10vh;
    width: 4vw;
    height: 8vw;
    background: sienna;
    border-radius: 0.5vw;
    z-index: 5;
  }
  .box {
    position: absolute;
    top: 30vh;
    width: 4vw;
    height: 4vw;
    background: gold;
    border-radius: 50%;
    z-index: 5;
  }
</style>
</head>
<body>
  <div id="game">
    <div id="ground"></div>
    <div id="dino"></div>
    <div id="score">Score: 0</div>
    <div id="coins">Coins: 0</div>

    <!-- Lobby -->
    <div id="lobby">
      <img id="logo" src="logo.png" alt="Game Logo" />
      <button id="playBtn"></button>
      <div id="lobbyButtons">
        <button class="topBtn" id="btnShop" style="background-image:url('shop.png')" title="Shop"></button>
        <button class="topBtn" id="btnCharacter" style="background-image:url('model.png')" title="Characters"></button>
        <button class="topBtn" id="btnBoard" style="background-image:url('board.png')" title="Leaderboard"></button>
      </div>
    </div>

    <!-- Modals -->
    <div id="shopModal" class="modal-bg">
      <div class="modal-panel">
        <span class="closeBtn" onclick="closeModal('shopModal')">✖</span>
        <h3>Shop</h3>
        <div class="charItem">
          <img src="peet.png" alt="Peet" />
          <button onclick="buyCharacter('Peet')">Buy</button>
        </div>
        <div class="charItem">
          <img src="broin.png" alt="Broin" />
          <button onclick="buyCharacter('Broin')">Buy</button>
        </div>
      </div>
    </div>

    <div id="characterPanel" class="modal-bg">
      <div class="modal-panel">
        <span class="closeBtn" onclick="closeModal('characterPanel')">✖</span>
        <h3>My Characters</h3>
        <div id="ownedCharacters"></div>
      </div>
    </div>

    <div id="leaderboard" class="modal-bg">
      <div class="modal-panel">
        <span class="closeBtn" onclick="closeModal('leaderboard')">✖</span>
        <h2>Leaderboard</h2>
        <p>Coming soon...</p>
      </div>
    </div>

    <div id="gameOver">
      <div>Game Over!</div>
      <button class="restartBtn" onclick="startGame()">Restart</button>
      <button class="lobbyBtn" onclick="showLobby()">Lobby</button>
    </div>

    <button id="jumpBtn" title="Jump"></button>
    <button id="slideBtn" title="Slide"></button>
  </div>

  <script>
    const dino = document.getElementById("dino");
    const scoreDisplay = document.getElementById("score");
    const coinsDisplay = document.getElementById("coins");
    const lobby = document.getElementById("lobby");
    const playBtn = document.getElementById("playBtn");
    const btnShop = document.getElementById("btnShop");
    const btnBoard = document.getElementById("btnBoard");
    const btnCharacter = document.getElementById("btnCharacter");
    const shopModal = document.getElementById("shopModal");
    const characterPanel = document.getElementById("characterPanel");
    const leaderboard = document.getElementById("leaderboard");
    const gameOverModal = document.getElementById("gameOver");
    const ownedCharactersContainer = document.getElementById("ownedCharacters");
    const jumpBtn = document.getElementById("jumpBtn");
    const slideBtn = document.getElementById("slideBtn");

    let owned = ["myDino.png"];
    let selectedCharacter = "myDino.png";
    let score = 0;
    let coins = 0;
    let obstacles = [];
    let boxes = [];
    let gameInterval;
    let gameSpeed = 0.6;
    let jumping = false;
    let sliding = false;

    // ฟิสิกส์กระโดด
    let velocityY = 0;
    const groundBottom = 10; // 10vh
    const jumpVelocity = 16; // กระโดดสูงขึ้นนิดหน่อย
    const gravity = -1.2; // แรงดึงลงเวลาตก ลดจากเดิมให้ตกช้าลง

    const popSound = new Audio("pop.mp3");
    const jumpSound = new Audio("jump.mp3");
    const slideSound = new Audio("slide.mp3");

    function openModal(id) { document.getElementById(id).style.display = "flex"; }
    function closeModal(id) { document.getElementById(id).style.display = "none"; }

    function buyCharacter(name) {
      if (!owned.includes(name)) {
        owned.push(name);
        alert("You bought " + name);
        updateOwned();
      } else {
        alert("You already own " + name);
      }
    }

    function updateOwned() {
      let html = "";
      owned.forEach(name => {
        let imgSrc = name === "Peet" ? "peet.png" : name === "Broin" ? "broin.png" : "myDino.png";
        html += `
          <div class="charItem">
            <img src="${imgSrc}" alt="${name}" />
            <button onclick="selectCharacter('${name}')">Use</button>
          </div>`;
      });
      if (html === "") html = "<p>No characters yet.</p>";
      ownedCharactersContainer.innerHTML = html;
    }

    function selectCharacter(name) {
      let img = name === "Peet" ? "peet.png" : name === "Broin" ? "broin.png" : "myDino.png";
      selectedCharacter = img;
      dino.style.backgroundImage = `url(${img})`;
      alert("You selected: " + name);
      closeModal("characterPanel");
    }

    btnShop.onclick = () => openModal("shopModal");
    btnCharacter.onclick = () => { updateOwned(); openModal("characterPanel"); };
    btnBoard.onclick = () => openModal("leaderboard");

    function showLobby() {
      lobby.style.display = "flex";
      closeModal("shopModal");
      closeModal("characterPanel");
      closeModal("leaderboard");
      gameOverModal.style.display = "none";
      jumpBtn.style.display = "none";
      slideBtn.style.display = "none";
      resetGame();
    }

    function resetGame() {
      score = 0;
      coins = 0;
      obstacles.forEach(o => o.remove());
      boxes.forEach(b => b.remove());
      obstacles = [];
      boxes = [];
      jumping = false;
      sliding = false;
      velocityY = 0;
      dino.style.bottom = groundBottom + "vh";
      dino.style.height = "auto";
      dino.classList.remove("slide");
      dino.style.backgroundImage = `url(${selectedCharacter})`;
      updateScore();
    }

    function startGame() {
      lobby.style.display = "none";
      gameOverModal.style.display = "none";
      resetGame();
      jumpBtn.style.display = "block";
      slideBtn.style.display = "block";
      if(gameInterval) clearInterval(gameInterval);
      gameInterval = setInterval(gameLoop, 20);
    }

    function updateScore() {
      scoreDisplay.textContent = "Score: " + score;
      coinsDisplay.textContent = "Coins: " + coins;
    }

    function createObstacle() {
      const obs = document.createElement("div");
      obs.classList.add("obstacle");
      obs.style.right = "-5vw";
      document.getElementById("game").appendChild(obs);
      obstacles.push(obs);
    }

    function createBox() {
      const box = document.createElement("div");
      box.classList.add("box");
      box.style.right = "-4vw";
      box.style.top = "30vh";
      document.getElementById("game").appendChild(box);
      boxes.push(box);
    }

    function isCollision(rect1, rect2) {
      return !(rect1.right < rect2.left || rect1.left > rect2.right || rect1.bottom < rect2.top || rect1.top > rect2.bottom);
    }

    function gameLoop() {
      score++;
      updateScore();

      // สร้าง obstacle ห่างกันอย่างน้อย 30vw
      if(Math.random() < 0.015) {
        let canSpawn = true;
        if(obstacles.length > 0) {
          const lastObs = obstacles[obstacles.length - 1];
          const lastObsRect = lastObs.getBoundingClientRect();
          const gameWidth = document.getElementById("game").getBoundingClientRect().width;
          const lastObsRightVW = (gameWidth - lastObsRect.right) / (gameWidth / 100);
          if(lastObsRightVW < 30) canSpawn = false;
        }
        if(canSpawn) createObstacle();
      }

      if(Math.random() < 0.007) createBox();

      obstacles.forEach((obs, i) => {
        let right = parseFloat(obs.style.right);
        right += gameSpeed;
        obs.style.right = right + "vw";
        if(right > 105) {
          obs.remove();
          obstacles.splice(i, 1);
        } else {
          if(isCollision(dino.getBoundingClientRect(), obs.getBoundingClientRect()) && !sliding) gameOver();
        }
      });

      boxes.forEach((box, i) => {
        let right = parseFloat(box.style.right);
        right += gameSpeed;
        box.style.right = right + "vw";
        if(right > 105) {
          box.remove();
          boxes.splice(i, 1);
        } else {
          if(isCollision(dino.getBoundingClientRect(), box.getBoundingClientRect())) {
            coins++;
            popSound.currentTime = 0;
            popSound.play();
            box.remove();
            boxes.splice(i, 1);
            updateScore();
          }
        }
      });

      // ฟิสิกส์กระโดด
      if (jumping) {
        velocityY += gravity * 0.4;
        let currentBottom = parseFloat(dino.style.bottom) || groundBottom;
        currentBottom += velocityY * 0.4;

        if (currentBottom <= groundBottom) {
          currentBottom = groundBottom;
          jumping = false;
          velocityY = 0;
        }
        dino.style.bottom = currentBottom + "vh";
      } else {
        dino.style.bottom = groundBottom + "vh";
      }
    }

    function gameOver() {
      clearInterval(gameInterval);
      gameOverModal.style.display = "flex";
      jumpBtn.style.display = "none";
      slideBtn.style.display = "none";
    }

    function jump() {
      if(!jumping && !sliding) {
        jumping = true;
        velocityY = jumpVelocity;
        jumpSound.currentTime = 0;
        jumpSound.play();
      }
    }

    function slide() {
      if(!jumping && !sliding) {
        sliding = true;
        slideSound.currentTime = 0;
        slideSound.play();
        dino.classList.add("slide");
        setTimeout(() => {
          sliding = false;
          dino.classList.remove("slide");
        }, 700);
      }
    }

    window.addEventListener("keydown", e => {
      if(e.code === "ArrowUp" || e.code === "KeyW" || e.code === "Space") jump();
      else if(e.code === "ArrowDown" || e.code === "KeyS") slide();
    });

    jumpBtn.onclick = jump;
    slideBtn.onclick = slide;

    // เล่นเพลงพื้นหลัง loop
    const bgm = new Audio("pop.mp3");
    bgm.loop = true;
    bgm.volume = 0.5;
    bgm.play().catch(() => {}); // ถ้า browser บล็อก autoplay เงียบๆไป

    showLobby();
    playBtn.onclick = startGame;
  </script>
</body>
</html>
