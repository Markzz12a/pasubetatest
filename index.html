<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>PasuGame Final</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      height: 100%;
      background: url("Background.webp") no-repeat center center/cover;
      font-family: sans-serif;
    }
    #gameCanvas {
      width: 100vw;
      height: 100vh;
      position: relative;
      overflow: hidden;
    }
    #player {
      width: 80px;
      height: 80px;
      position: absolute;
      left: 100px;
      bottom: 120px;
      background-size: contain;
      background-repeat: no-repeat;
      transition: bottom 0.2s;
    }
    .slide {
      height: 40px !important;
    }
    .obstacle, .ceilingObstacle {
      width: 60px;
      height: 60px;
      background: brown;
      position: absolute;
      bottom: 120px;
    }
    .ceilingObstacle {
      top: 0;
      bottom: auto;
      background: darkred;
    }
    .coin {
      width: 40px;
      height: 40px;
      background: gold;
      border-radius: 50%;
      position: absolute;
      bottom: 200px;
      box-shadow: 0 0 10px yellow;
    }
    #jumpBtn, #slideBtn {
      position: absolute;
      bottom: 20px;
      width: 70px;
      height: 70px;
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      z-index: 10;
    }
    #jumpBtn {
      right: 100px;
      background-image: url("jump.png");
    }
    #slideBtn {
      right: 20px;
      background-image: url("slide.png");
    }
    #coinCount, #score {
      position: absolute;
      top: 10px;
      font-size: 20px;
      font-weight: bold;
      color: white;
      text-shadow: 0 0 5px black;
      z-index: 10;
    }
    #coinCount { left: 10px; }
    #score { right: 10px; }
    #lobby {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.7);
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    #charSelect {
      display: flex;
      gap: 10px;
      overflow-x: auto;
      padding: 10px;
      margin-bottom: 20px;
    }
    .charOption {
      width: 80px;
      height: 80px;
      background-size: cover;
      background-position: center;
      border: 3px solid transparent;
      border-radius: 10px;
      cursor: pointer;
    }
    .charOption.selected {
      border-color: yellow;
    }
    #gameOver {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.8);
      color: white;
      z-index: 1000;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      gap: 20px;
    }
    button {
      padding: 10px 20px;
      font-size: 18px;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      background: orange;
      color: white;
      cursor: pointer;
    }
    @media (orientation: portrait) {
      body::before {
        content: "Please rotate your device.";
        position: fixed;
        inset: 0;
        background: #000;
        color: white;
        font-size: 30px;
        z-index: 2000;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
      }
    }
  </style>
</head>
<body>
  <div id="gameCanvas">
    <div id="player"></div>
    <div id="coinCount">Coins: 0</div>
    <div id="score">Score: 0</div>
    <button id="jumpBtn"></button>
    <button id="slideBtn"></button>
  </div>

  <div id="lobby">
    <h1>PasuGame</h1>
    <div id="charSelect">
      <div class="charOption selected" data-char="myDino.png" style="background-image:url('myDino.png')"></div>
      <div class="charOption" data-char="peet.png" style="background-image:url('peet.png')"></div>
      <div class="charOption" data-char="broin.png" style="background-image:url('broin.png')"></div>
      <div class="charOption" data-char="20250707_123932.png" style="background-image:url('20250707_123932.png')"></div>
      <div class="charOption" data-char="20250707_123608.png" style="background-image:url('20250707_123608.png')"></div>
    </div>
    <button id="playBtn">Play</button>
  </div>

  <div id="gameOver" style="display:none;">
    <div>Game Over!</div>
    <button onclick="location.reload()">Restart</button>
  </div>

  <audio id="jumpSound" src="jump.mp3"></audio>
  <audio id="slideSound" src="slide.mp3"></audio>

  <script>
    const player = document.getElementById('player');
    const jumpBtn = document.getElementById('jumpBtn');
    const slideBtn = document.getElementById('slideBtn');
    const lobby = document.getElementById('lobby');
    const gameOver = document.getElementById('gameOver');
    const coinCountEl = document.getElementById('coinCount');
    const scoreEl = document.getElementById('score');
    const jumpSound = document.getElementById('jumpSound');
    const slideSound = document.getElementById('slideSound');

    let isJumping = false;
    let isSliding = false;
    let velocityY = 0;
    let gravity = 1;
    let score = 0;
    let coins = 0;
    let playerChar = 'myDino.png';

    function setCharacter(char) {
      playerChar = char;
      player.style.backgroundImage = `url(${char})`;
    }

    document.querySelectorAll('.charOption').forEach(option => {
      option.onclick = () => {
        document.querySelectorAll('.charOption').forEach(o => o.classList.remove('selected'));
        option.classList.add('selected');
        setCharacter(option.dataset.char);
      };
    });

    document.getElementById('playBtn').onclick = () => {
      lobby.style.display = 'none';
      setCharacter(playerChar);
      startGame();
    };

    jumpBtn.onclick = () => jump();
    slideBtn.onclick = () => slide();
    document.addEventListener('keydown', e => {
      if (e.code === 'Space' || e.code === 'ArrowUp') jump();
      if (e.code === 'ArrowDown') slide();
    });

    function jump() {
      if (isJumping || isSliding) return;
      isJumping = true;
      velocityY = 20;
      jumpSound.play();
    }

    function slide() {
      if (isJumping || isSliding) return;
      isSliding = true;
      player.classList.add('slide');
      slideSound.play();
      setTimeout(() => {
        player.classList.remove('slide');
        isSliding = false;
      }, 800);
    }

    function startGame() {
      const game = document.getElementById('gameCanvas');
      const obstacles = [];
      const ceilingObstacles = [];
      const coinItems = [];

      function spawnObstacle() {
        const ob = document.createElement('div');
        ob.className = 'obstacle';
        ob.style.left = '100vw';
        game.appendChild(ob);
        obstacles.push(ob);
      }

      function spawnCeilingObstacle() {
        const ob = document.createElement('div');
        ob.className = 'ceilingObstacle';
        ob.style.left = '100vw';
        ob.style.height = '80px';
        game.appendChild(ob);
        ceilingObstacles.push(ob);
      }

      function spawnCoin() {
        const c = document.createElement('div');
        c.className = 'coin';
        c.style.left = '100vw';
        game.appendChild(c);
        coinItems.push(c);
      }

      function gameLoop() {
        // Physics
        if (isJumping) {
          let bottom = parseFloat(getComputedStyle(player).bottom);
          bottom += velocityY;
          velocityY -= gravity;
          if (bottom <= 120) {
            bottom = 120;
            isJumping = false;
          }
          player.style.bottom = bottom + 'px';
        }

        // Move & detect
        [...obstacles, ...ceilingObstacles, ...coinItems].forEach(item => {
          let left = parseFloat(item.style.left);
          left -= 5;
          item.style.left = left + 'px';

          const pRect = player.getBoundingClientRect();
          const iRect = item.getBoundingClientRect();

          if (left < -100) item.remove();

          // Coin collect
          if (item.className === 'coin' &&
            pRect.left < iRect.right &&
            pRect.right > iRect.left &&
            pRect.top < iRect.bottom &&
            pRect.bottom > iRect.top
          ) {
            item.remove();
            coins++;
            coinCountEl.textContent = "Coins: " + coins;
          }

          // Collision
          if ((item.className.includes('obstacle') || item.className.includes('ceilingObstacle')) &&
            pRect.left < iRect.right &&
            pRect.right > iRect.left &&
            pRect.top < iRect.bottom &&
            pRect.bottom > iRect.top
          ) {
            gameOver.style.display = 'flex';
            cancelAnimationFrame(loop);
          }
        });

        // Spawn random
        if (Math.random() < 0.02) spawnObstacle();
        if (Math.random() < 0.01) spawnCeilingObstacle();
        if (Math.random() < 0.02) spawnCoin();

        score++;
        scoreEl.textContent = "Score: " + score;

        loop = requestAnimationFrame(gameLoop);
      }

      let loop = requestAnimationFrame(gameLoop);
    }
  </script>
</body>
</html>
